
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../logo.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Models and Likelihoods - Combine</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../mystyle.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#models-and-likelihoods" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../.."> 


    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Combine" class="md-header__button md-logo" aria-label="Combine" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Combine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Models and Likelihoods
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part2/settinguptheanalysis/" class="md-tabs__link">
          
  
    
  
  Setting up the analysis

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part3/runningthetool/" class="md-tabs__link">
          
  
    
  
  Running combine

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../part4/usefullinks/" class="md-tabs__link">
        
  
    
  
  Links & FAQ

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part5/roofit/" class="md-tabs__link">
          
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Combine" class="md-nav__button md-logo" aria-label="Combine" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    Combine
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setting up the analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Setting up the analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/settinguptheanalysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparing the datacard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/physicsmodels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Physics models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/bin-wise-stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatic MC statistical uncertainties
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Running combine
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Running combine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/runningthetool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the tool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/commonstatsmethods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common statistical methods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/nonstandard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced use cases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/simplifiedlikelihood/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simplified Likelihoods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/regularisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unfolding & regularization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validating datacards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging fit failures
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/usefullinks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Links & FAQ
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/roofit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RooFit Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/longexercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercise: main features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/longexerciseanswers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solutions to long exercise
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-model" class="md-nav__link">
    <span class="md-ellipsis">
      The Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-likelihood" class="md-nav__link">
    <span class="md-ellipsis">
      The Likelihood
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Likelihood">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#binned-data-likelihoods" class="md-nav__link">
    <span class="md-ellipsis">
      Binned Data Likelihoods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unbinned-data-likelihoods" class="md-nav__link">
    <span class="md-ellipsis">
      Unbinned Data Likelihoods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constraint-likelihoods" class="md-nav__link">
    <span class="md-ellipsis">
      Constraint Likelihoods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generic-binned-likelihoods" class="md-nav__link">
    <span class="md-ellipsis">
      Generic binned likelihoods
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="models-and-likelihoods">Models and Likelihoods</h1>
<h2 id="the-model">The Model</h2>
<p>The Model <span class="arithmatex"><span class="MathJax_Preview">\mathcal{M}(\vec{\mu},\vec{\theta})</span><script type="math/tex">\mathcal{M}(\vec{\mu},\vec{\theta})</script></span> defines the expected observations given the input parameters of interest <span class="arithmatex"><span class="MathJax_Preview">\vec{\mu}</span><script type="math/tex">\vec{\mu}</script></span> and nuisance parameters <span class="arithmatex"><span class="MathJax_Preview">\vec{\theta}</span><script type="math/tex">\vec{\theta}</script></span>.</p>
<p>Combine is designed for essentially counting experiments, where the number of events with particular features are counted.<br />
Three basic types of model can be provided to combine:</p>
<ol>
<li>A simple counting experiment, in which only the expected number of observed events is specified and how this number depends on a set of parameters.</li>
<li>A template analysis, in which observed events are divided into various regions (e.g. histogram bins defining regions of invariant mass of two photons in an event), and the expected observation for each bin is defined</li>
<li>A parametric analysis, in which continuous functions define the probability density of observing events with a given set of characterstics (e.g. where the highest energy photon has a given pseudorapidity and transvere momentum).</li>
</ol>
<p>These last two types of analysis are often collectively referred to as "shape-based" analyses. </p>
<p>Furthermore, models can be composed of multiple channels and processes.</p>
<p><strong>Channels</strong>: The model is a set of models for multiple channels. <span class="arithmatex"><span class="MathJax_Preview">\mathcal{M} = \{ m_{c1}, m_{c2}, .... m_{cN}\}</span><script type="math/tex">\mathcal{M} = \{ m_{c1}, m_{c2}, .... m_{cN}\}</script></span>. 
    The expected observations which define the model is then the union of the sets of expected observations in each individual channel.</p>
<p><strong>Processes</strong>: The model consists of a sum over different processes, each processes having its own model defining it,  <span class="arithmatex"><span class="MathJax_Preview">m_{c} =\sum_{p} m_{c,p}</span><script type="math/tex">m_{c} =\sum_{p} m_{c,p}</script></span>.
    the expected observations is then the sum of the expected observations for each of the processes.</p>
<p>Combining full models together is then possible by combining their channels together, assuming that the channels are each independent.</p>
<p>Generally we are not interested in one specific model with perfectly known parameters. We are typically interested in a set of models, parameterized by a set of real numbers representing possible versions of the model.</p>
<p><strong>Model Parameters</strong>: A number of parameters can modify the model expectation. These include the parameters of interest ( <span class="arithmatex"><span class="MathJax_Preview">\vec{\mu}</span><script type="math/tex">\vec{\mu}</script></span>, those being measured) as well as nuisance parameters (<span class="arithmatex"><span class="MathJax_Preview">\vec{\theta}</span><script type="math/tex">\vec{\theta}</script></span>), which may not be of interest but still affect the model expectation.</p>
<p>The full model therefore defines the expected observations over all the channels, given all the processes and model parameters:</p>
<div class="arithmatex">
<div class="MathJax_Preview"> \mathcal{M} = \{ m_{c1}(\vec{\mu},\vec{\theta}), m_{c2}(\vec{\mu},\vec{\theta}), ..., m_{cN}(\vec{\mu},\vec{\theta}) \} </div>
<script type="math/tex; mode=display"> \mathcal{M} = \{ m_{c1}(\vec{\mu},\vec{\theta}), m_{c2}(\vec{\mu},\vec{\theta}), ..., m_{cN}(\vec{\mu},\vec{\theta}) \} </script>
</div>
<p>Combine provides tools and interfaces for defining the model as arbitrary functions of the input parameters.
In practice, however, there are a number of most commonly used functional forms which define how the expected events depend on the model parameters.
These are discussed in detail in the context of the full likelihood below.</p>
<h2 id="the-likelihood">The Likelihood</h2>
<p>Combine builds a likelihood model through the <code>text2workspace.py</code> script, given the model which is defined by the <code>Datacard</code>.
The <code>Datacard</code> defines the observables being considered, the observations, the processes which contribute, the uncertainties, and various relationships between each of these.
The <code>text2workspace.py</code> script takes this datacard and any other input files it references (for example root files which may contain histograms) and builds a <code>RooWorkspace</code> which defines the likelihood model.</p>
<p>The likelihood takes the general form:</p>
<div class="arithmatex">
<div class="MathJax_Preview"> \mathcal{L} =  \mathcal{L}_{\textrm{data}} \cdot \mathcal{L}_{\textrm{constraint}} </div>
<script type="math/tex; mode=display"> \mathcal{L} =  \mathcal{L}_{\textrm{data}} \cdot \mathcal{L}_{\textrm{constraint}} </script>
</div>
<p>Where $ \mathcal{L}_\mathrm{data} $ is the likelihood of observing the data given your model, and <span class="arithmatex"><span class="MathJax_Preview">\mathcal{L}_\mathrm{constraint}</span><script type="math/tex">\mathcal{L}_\mathrm{constraint}</script></span> represent some external constraints.
The data term determine how probable any set of data is given the model for particular values of the model parameters. 
The constraint term does not depend on the observed data, but rather encodes other constraints which may be constraints from previous measurements (such as Jet Energy Scales) or prior beliefs about the value some parameter in the model should have. i.e. they encode the a priori likelihood of the given parameters.</p>
<p>In general each is, in turn, composed of many sublikelihoods. 
For example in a binned shape analysis every bin has its own term representing the probability of observing the actual observed number of events given the expected number of events.
Similarly, for every systematic uncertainty there will be some constraint term associated with the uncertainty.</p>
<p>This model is extremely general. Without yet specifying any function forms for these likelihoods, this model can represent anything at all.
However, as with the model itself, there are typical forms that the likelihoods take which will cover most use cases, and for which combine is primarily designed.</p>
<p>Combine is designed for constructing data likelihoods which refer to observation of some count of events, though they can be binned or unbinned.
The constraint terms also often take on common forms, such as that of a gaussian distribution.</p>
<h3 id="binned-data-likelihoods">Binned Data Likelihoods</h3>
<p>For a binned likelihood, the probability of observing a certain number of counts, given a model takes on a simple form. For each bin:</p>
<div class="arithmatex">
<div class="MathJax_Preview">
\mathcal{L}_{\mathrm{bin}}(\vec{\mu},\vec{\theta}|\mathrm{data}) = \mathrm{Poiss}(\mathrm{obs}| n_{\mathrm{exp}}) 
</div>
<script type="math/tex; mode=display">
\mathcal{L}_{\mathrm{bin}}(\vec{\mu},\vec{\theta}|\mathrm{data}) = \mathrm{Poiss}(\mathrm{obs}| n_{\mathrm{exp}}) 
</script>
</div>
<p>i.e. it is a poisson distribution with the mean given by the expected number of events in that bin. 
The full data likelihood is simply the product of each of the bins' likelihoods:</p>
<div class="arithmatex">
<div class="MathJax_Preview"> \mathcal{L}_\mathrm{data} = \prod_\mathrm{bins} \mathcal{L}_\mathrm{bin}. </div>
<script type="math/tex; mode=display"> \mathcal{L}_\mathrm{data} = \prod_\mathrm{bins} \mathcal{L}_\mathrm{bin}. </script>
</div>
<p>This is the underlying likelihood model used for every binned analysis. 
The freedom in the analysis comes in how <span class="arithmatex"><span class="MathJax_Preview">n_\mathrm{exp}</span><script type="math/tex">n_\mathrm{exp}</script></span> depends on the model parameters, and the constraints that are place on those parameters.</p>
<h3 id="unbinned-data-likelihoods">Unbinned Data Likelihoods</h3>
<p>For unbinned likelihood models, a likelihood can be given to each data point. It is just equal to probability density function at that point, <span class="arithmatex"><span class="MathJax_Preview">\vec{x}</span><script type="math/tex">\vec{x}</script></span>.</p>
<div class="arithmatex">
<div class="MathJax_Preview"> \mathcal{L}_\mathrm{data} = \prod_{i} \mathrm{pdf}(\vec{x}_i | \vec{\mu}, \vec{\theta} ) </div>
<script type="math/tex; mode=display"> \mathcal{L}_\mathrm{data} = \prod_{i} \mathrm{pdf}(\vec{x}_i | \vec{\mu}, \vec{\theta} ) </script>
</div>
<h3 id="constraint-likelihoods">Constraint Likelihoods</h3>
<p>In principle, the constraint terms in the likelihood can be arbitrary. 
They simply encode the probability of model parameters taking on a certain value.
This might represent the probability that a cross section has a certain value, or that the true luminosity is shifted by some amount as compared to the nominal value.
In practice, most constraint terms are gaussian, of the form <span class="arithmatex"><span class="MathJax_Preview">\mathcal{N}(0,1)</span><script type="math/tex">\mathcal{N}(0,1)</script></span> where the model parameter, often denoted <span class="arithmatex"><span class="MathJax_Preview">\theta</span><script type="math/tex">\theta</script></span>, has been defined such that 0 is its nominal value and <span class="arithmatex"><span class="MathJax_Preview">\pm1</span><script type="math/tex">\pm1</script></span> represent its value shifted to the edges of the 68\% confidence range; i.e. these two values define the bounds of the region in which you expect to find the parameter 68\% of the time.</p>
<p>It is not <em>necessary</em> that these constraint terms take on such a gaussian form. They can be arbitrary functions.
However, it is very convenient to use gaussian constraints for a number of reasons*. </p>
<p>Furthermore, the form of the constraint terms, on their own is not in and of itself meaningful; what is meaningful is the relationship between the constraint term and how the model expectation is altered by the parameter.
Any co-ordinate transformation of the parameter values can be absorbed into the definition of the parameter; i.e. the likelihood model is independent of how it is parameterized.
A reparameterization would change the mathematical form of the constraint term, but would also simultaneously change how the model depends on the parameter in such a way that the total likelihood is unchanged.
e.g. if you define  <span class="arithmatex"><span class="MathJax_Preview">\theta = \sigma(tt)</span><script type="math/tex">\theta = \sigma(tt)</script></span> or <span class="arithmatex"><span class="MathJax_Preview">\theta = \sigma(tt) - \sigma_0</span><script type="math/tex">\theta = \sigma(tt) - \sigma_0</script></span> you will change the form of the constraint term, but the you will not change the overall likelihood.</p>
<p>While these can represent bayesian priors, they are often representing frequentist estimates of the nuisance parameter value based on external measurements (such as and independent luminosity measurement).
In this context, it is often also useful to speak of "global observables" or the "constraint values", <span class="arithmatex"><span class="MathJax_Preview">\vec{\tilde{\theta}}</span><script type="math/tex">\vec{\tilde{\theta}}</script></span> which represent the best estimate of the observed value from the external measurement.
The likelihood constraint terms then depends on these global observables, in the same way that the data likelihood depends on the observed data.</p>
<p>We therefore write:</p>
<div class="arithmatex">
<div class="MathJax_Preview"> \mathcal{L}_\mathrm{constraint} = \prod_{e=1}^{N_E} p_e(\tilde{\theta}|\theta) </div>
<script type="math/tex; mode=display"> \mathcal{L}_\mathrm{constraint} = \prod_{e=1}^{N_E} p_e(\tilde{\theta}|\theta) </script>
</div>
<p>Where, <span class="arithmatex"><span class="MathJax_Preview">p_e</span><script type="math/tex">p_e</script></span> is then the probability density for the external measurement to have measured a value of <span class="arithmatex"><span class="MathJax_Preview">\tilde{\theta}</span><script type="math/tex">\tilde{\theta}</script></span> for the nuisance parameter if its true value is <span class="arithmatex"><span class="MathJax_Preview">\theta</span><script type="math/tex">\theta</script></span>.
Often, though not always, <span class="arithmatex"><span class="MathJax_Preview">p_e</span><script type="math/tex">p_e</script></span> is a normal distribution centered at <span class="arithmatex"><span class="MathJax_Preview">\tilde{\theta}</span><script type="math/tex">\tilde{\theta}</script></span> and the coordinates are chosen such that <span class="arithmatex"><span class="MathJax_Preview">\tilde{\theta} \equiv 0</span><script type="math/tex">\tilde{\theta} \equiv 0</script></span> and the width of the probability density is 1.
i.e. <span class="arithmatex"><span class="MathJax_Preview">p_e \propto \exp{(-0.5 (\frac{(\theta - \tilde{\theta})}{\sigma})^2 )} = \exp{(-0.5 \theta^2)}</span><script type="math/tex">p_e \propto \exp{(-0.5 (\frac{(\theta - \tilde{\theta})}{\sigma})^2 )} = \exp{(-0.5 \theta^2)}</script></span>.</p>
<h3 id="generic-binned-likelihoods">Generic binned likelihoods</h3>
<p>Although customizations are possible, binned likelihood models can be defined by the user by providing simple inputs such as a set of histograms and systematic uncertainties.</p>
<p>Here, we describe the details of the mathematical form of these likelihoods. 
As already mentioned, the likelihood can be written as a product of two parts:</p>
<div class="arithmatex">
<div class="MathJax_Preview"> \mathcal{L} =  \mathcal{L}_\mathrm{data} \cdot \mathcal{L}_\mathrm{constraint} = \prod_{c=1}^{N_c} \prod_{b=1}^{N_b^c} \mathrm{Poiss}(n_{cb}| n^\mathrm{exp}_{cb}(\vec{\mu},\vec{\theta})) \prod_{e=1}^{N_E} p_e(\tilde{\theta}_e | \theta_e) </div>
<script type="math/tex; mode=display"> \mathcal{L} =  \mathcal{L}_\mathrm{data} \cdot \mathcal{L}_\mathrm{constraint} = \prod_{c=1}^{N_c} \prod_{b=1}^{N_b^c} \mathrm{Poiss}(n_{cb}| n^\mathrm{exp}_{cb}(\vec{\mu},\vec{\theta})) \prod_{e=1}^{N_E} p_e(\tilde{\theta}_e | \theta_e) </script>
</div>
<p>Where <span class="arithmatex"><span class="MathJax_Preview">c</span><script type="math/tex">c</script></span> indexes the channel, <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span> indexes the histogram bin, and <span class="arithmatex"><span class="MathJax_Preview">e</span><script type="math/tex">e</script></span> indexes the nuisance parameter. 
For the standard binned likelihood fits the constraint terms are always implemented as either a gaussian or a uniform function. </p>
<p>$$ p_e \propto \exp{(-0.5 (\frac{(\theta - \tilde{\theta})}{\sigma})^2 )} \mathrm{; or} $$
$$ p_e \propto \mathrm{constant\ (on\ some\ interval\ [a,b])}$$.</p>
<p>Note that it is not always the case that <span class="arithmatex"><span class="MathJax_Preview">\tilde{\theta} = 0</span><script type="math/tex">\tilde{\theta} = 0</script></span> or <span class="arithmatex"><span class="MathJax_Preview">\sigma = 1</span><script type="math/tex">\sigma = 1</script></span>.</p>
<p>Nonetheless, with this parameterization of the nuisance parameters, there is a lot of freedom in defining different types of models based on how the nuisance parameters affect the expected distribution <span class="arithmatex"><span class="MathJax_Preview">n^\mathrm{exp}_{cb}</span><script type="math/tex">n^\mathrm{exp}_{cb}</script></span>.</p>
<p>The generic model implemented in combine is given by:</p>
<div class="arithmatex">
<div class="MathJax_Preview">n^\mathrm{exp}_{cb} = \mathrm{max}(0, \sum_{p} M_{cp}(\vec{\mu})N_{cp}(\vec{\theta_L},\vec{\theta_S},\vec{\theta_G},\vec{\theta}_{\rho})y_{cbp}(\vec{\theta}_S) + E_{cb}(\vec{\theta}_B) ) </div>
<script type="math/tex; mode=display">n^\mathrm{exp}_{cb} = \mathrm{max}(0, \sum_{p} M_{cp}(\vec{\mu})N_{cp}(\vec{\theta_L},\vec{\theta_S},\vec{\theta_G},\vec{\theta}_{\rho})y_{cbp}(\vec{\theta}_S) + E_{cb}(\vec{\theta}_B) ) </script>
</div>
<p>where here: </p>
<ul>
<li><span class="arithmatex"><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> indexes the processes contributing to the channel; </li>
<li><span class="arithmatex"><span class="MathJax_Preview">\vec{\theta_L}, \vec{\theta_S}, \vec{\theta_G}, \vec{\theta_{\rho}}</span><script type="math/tex">\vec{\theta_L}, \vec{\theta_S}, \vec{\theta_G}, \vec{\theta_{\rho}}</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\vec{\theta_B}</span><script type="math/tex">\vec{\theta_B}</script></span> are different types of nuisance parameters which modify the processes with different functional forms;<ul>
<li><span class="arithmatex"><span class="MathJax_Preview">\vec{\theta}_{L}</span><script type="math/tex">\vec{\theta}_{L}</script></span> are log-normal nuisances,</li>
<li><span class="arithmatex"><span class="MathJax_Preview">\vec{\theta}_{S}</span><script type="math/tex">\vec{\theta}_{S}</script></span> are shape nuisances,</li>
<li><span class="arithmatex"><span class="MathJax_Preview">\vec{\theta}_{G}</span><script type="math/tex">\vec{\theta}_{G}</script></span> are gamma nuisances,</li>
<li><span class="arithmatex"><span class="MathJax_Preview">\vec{\theta}_{\rho}</span><script type="math/tex">\vec{\theta}_{\rho}</script></span> are rate parameters, and</li>
<li><span class="arithmatex"><span class="MathJax_Preview">\vec{\theta}_{B}</span><script type="math/tex">\vec{\theta}_{B}</script></span> are monte-carlo statisical nuisance parameters.</li>
</ul>
</li>
<li><span class="arithmatex"><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span> defines the effect of the parameters of interest on the signal process;</li>
<li><span class="arithmatex"><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span> defines the overall normalization effect of the nuisance parameters;</li>
<li><span class="arithmatex"><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> defines the shape effects (i.e. bin-dependent effects) of the nuisance parameters; and</li>
<li><span class="arithmatex"><span class="MathJax_Preview">E</span><script type="math/tex">E</script></span> defines the impact of statistical uncertainties from the samples used to derive the histogram templates used to build the model.</li>
</ul>
<p>The form of <span class="arithmatex"><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span> can take on aribitrary functional forms, as defined by the user, but in the most common case, the nuisance parameters <span class="arithmatex"><span class="MathJax_Preview">\mu</span><script type="math/tex">\mu</script></span> simply scale the contributions from signal processes:</p>
<div class="arithmatex">
<div class="MathJax_Preview">
M_{cp}(\mu) = \begin{cases} 
    \mu  &amp;\mathrm{if } p \in \mathrm{signal} \\
    1    &amp;\mathrm{otherwise} \end{cases}
</div>
<script type="math/tex; mode=display">
M_{cp}(\mu) = \begin{cases} 
    \mu  &\mathrm{if } p \in \mathrm{signal} \\
    1    &\mathrm{otherwise} \end{cases}
</script>
</div>
<p>The overall normalization <span class="arithmatex"><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span> is affected differently by the different types of nuisances parameters, and takes the general form <span class="arithmatex"><span class="MathJax_Preview">N = \prod_X f_x(\vec{\theta}_X)</span><script type="math/tex">N = \prod_X f_x(\vec{\theta}_X)</script></span>, multiplying together the morphings from each of the nuisance types.</p>
<details>  
<summary><b>Show Normalization Parameterization Details</b></summary> 

The full functional form of the normalization term is given by:

$$ N_{cp} = N_{\mathrm{0}}(\theta_{G})\prod_{n} {\kappa_{n}}^{\theta_{L,n}}\prod_{a} {\kappa^{\mathrm{A}}_{a}(\theta_{L(S)}^{a},\kappa^{+}_{a}, \kappa^{-}_{a})}^{\theta_{L(S)}^{a}} \prod_{r}F_{r}(\rho) $$

where:

- $N_{\mathrm{0}}(\theta_{G})$, in which each process normalization is optionally adjusted by a single gamma uncertainty, in terms of the number of externally observed events $\tilde{\theta}_{G}$, where $N_\mathrm{0}$ is $\theta_{G} / \tilde{\theta}_{G}$ if the uncertainty is applied, and unity otherwise;
- $\kappa_{n}^{\theta_{L,n}}$, the log-normal uncertainties specified by a fixed value $\kappa$;
- $\kappa^{\mathrm{A}}_{a}(\theta_{L(S)}^{a},\kappa^{+}_{a}, \kappa^{-}_{a})$: the asymmetric log-normal uncertainties, in which the value of $\kappa^{\mathrm{A}}$ depends on the nuisance parameter and two fixed values $\kappa^{+}_{a}$ and $\kappa^{-}_{a}$. The functions, $\kappa^A$, defines a smooth interpolation for the asymmetric uncertainty, which would otherwise not be smooth.
- $F_{r}(\rho)$, which are arbitrary user-defined functions of the unconstrained nuisance parameters

The function for the asymmetric normalization modifier, $\kappa^A$ is 

$$
    \kappa^{\mathrm{A}}(\theta,\kappa^{+}, \kappa^{-}) =
    \begin{cases}
        \kappa^{+}, &\mathrm{for } \theta \geq 0.5 \\
        \kappa^{-}, &\mathrm{for } \theta \leq -0.5 \\
        \exp\left(\frac{1}{2} \left( (\ln{\kappa^{+}}+\ln{\kappa^{+}}) + \frac{1}{4}(\ln{\kappa^{+}}-\ln{\kappa^{-}})I(\theta)\right)\right), &\mathrm{otherwise}\end{cases}
$$

where $I(\theta) = 48\theta^5 - 40\theta^3 + 15\theta$, which ensures $\kappa^{\mathrm{A}}$ and its first and second derivatives are continuous for all values of $\theta$.

</details>

<p>The number of events in a given bin <span class="arithmatex"><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>, <span class="arithmatex"><span class="MathJax_Preview">y_{cbp}</span><script type="math/tex">y_{cbp}</script></span>, is a function of the shape parameters <span class="arithmatex"><span class="MathJax_Preview">\vec{\theta}_{S}</span><script type="math/tex">\vec{\theta}_{S}</script></span>. 
The shape interpolation works with the fractional yields in each bin</p>
<details>
<summary><b>Show shape parameterization Details</b></summary>

In the following, the channel and process labels $c$ and $p$ apply to every term, and so are omitted.

The fixed nominal number of events is denoted $y_{b}^{0}$.
For each applicable shape uncertainty $s$, two additional predictions are specified, $y_{b}^{s,+}$ and $y_{b}^{s,-}$, typically corresponding to the $+1\sigma$ and $-1\sigma$ variations, respectively.
These may change both the shape and normalization of the process.
The two effects are separated; the shape transformation is constructed in terms of the fractional event counts in the templates via a smooth vertical interpolation, and the normalization is treated as an asymmetric log-normal uncertainty, as described above. For the latter, the $\kappa^{+}$ and $\kappa^{-}$ values are defined as

$$
\kappa^{\pm}_{s} = \frac{\sum_{b}y_{b}^{s,\pm}}{\sum_{b}y_{b}^{0}}.
$$

For a given process, the shape may be interpolated either directly in terms of the fractional bin yields, $f_b = y_b / \sum y_{b}$ or their logarithms, $\ln(f_b)$. The transformed yield is then given as, respectively,

$$
y_{b}(\vec{\theta}) =
\begin{cases}
\max\left(0, y^{0}\left(f^{0}_{b} + \sum_{s} F(\theta_{s}, \delta^{s,+}_{b}, \delta^{s,-}_{b}), \epsilon_{s}\right)\right) & \text{(direct),}\\
\max\left(0, y^{0} f^{0}_{b} \prod_{s} F(\theta_{s}, \Delta^{s,+}_{b}, \Delta^{s,-}_{b}, \epsilon_{s}) \right) & \text{(logarithmic)},
\end{cases}
$$

where $y^{0} = \sum y_{b}^{0}$, $\delta^{\pm} = f^{\pm}_{i} - f^{0}_{i}$, and $\Delta^{\pm} = \ln(\frac{f^{\pm}_{i}}{f^{0}_{i}})$. 


The smooth interpolating function $F$, defined below, depends on a set of coefficients, $\epsilon_{s}$. These are assumed to be unity by default, but may be set to different values, for example if the $y_{b}^{s,\pm}$ correspond to the $\pm X\sigma$ variations, then $\epsilon_{s} = 1/X$ is typically set. The minimum value of $\epsilon$ over the shape uncertainties for a given process is  $q = \min({{\epsilon_{s}}})$. The function ${F}$ is then defined as

$$
f(\theta, \delta^{+}, \delta^{-}) = 
\begin{cases}
\frac{1}{2}\theta^{'} \left( (\delta^{+}-\delta^{-}) + \frac{1}{8}(\delta^{+}+\delta^{-})(3\bar{\theta}^5 - 10\bar{\theta}^3 + 15\bar{\theta}) \right), & \text{for } -q < \theta < q; \\
\theta^{'}\delta^{+}, & \text{for } \theta \ge q;\\
-\theta^{'}\delta^{-}, & \text{for } \theta \le -q;\\
\end{cases}
$$

where $\theta^{'} = \theta\epsilon$, $\bar{\theta} = \theta^{'} / q$, and the label $s$ has been omitted. This function ensures the yield and its first and second derivatives are continuous for all values of $\theta$.
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.footer", "navigation.indexes", "navigation.expand", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>