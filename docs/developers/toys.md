# Generating Toys

In general there are two types of toys generated and used by combine. 
The first type of toys are toys where the actual toy data information can be stored and a specific algorithm run over that toy.
In this case, the toys are generated the main `Combine` object, and then the algorithm (limit, significance etc...) is called on each individual toy.

The other type of toy is when using the `HybridNew` method, which internally generates toys and and runs the statistical test on those toys. 
The toys are never touched by the external combine object, and their data can't be saved.
Instead, only they are only kept for the test statistic of interest and discarded.

# Toys generated by the main combine object

If some number of toys is set, then the main `Combine` object does the task of actually generating them.

There is a block within the Combine `run` method, which does the following:

makes sure there is a background-only pdf to generate toys from

Generates a SimPdfGenInfo object from the pdf and observables.
loads a clean workspace snapshot
gets a list of all parameters from the workspace, and then remove the POIs from that list
if sampling nuisance parameters:
   reset the nuisance pdf to the appropriate "nominal" model 
   if doing frequentist toys 
       save a snapshot 
       if not bypassing the frequentist fit
           set POIs constant 
           create the nll from the nominal model pdf
           minimize
           set POIs floating again
           save a "clean" snapshot -- NOTE: not "really clean"
        generate nToys from the nuisance Pdf, passing the GlobalObservables as the argset
    if not doing frequentist toys:
        generate nToys from the nuisance Pdf, passing the nuisance list as the argset

Gets the list of variables,
sets nToys in the fitting algo
loops over toys:
   sets parameter ranges if set on the command line 
   set the toy number 
   makes a dummy toy data object
   if not reading the toys from somewhere else: 
        load "clean" workspace snapshot (postfit if bypass frequentist fit wasnt done)    
        loads the "syst dataset" toy created from the nuisance generation
        if toysFrequentist, save a "clean" snapshot
        save the state in the tree
        make proper "toy data"
        
        
# Toys generated with HybridNew

For toys generated by the `HybridNew` method, a `ToyMCSamplerOpt` (or untested `ToyMCSampler` ) object is created in the `create` function of the `HybridNew` object. 

The ToySampler object gets passed (along with a number of other setup objects) to the RooStats [`HybridCalculator` object](https://root.cern.ch/doc/master/classRooStats_1_1HybridCalculator.html)

utlimately the `HybridCalculator`'s `GetHypoTest` method is called, which
    
## Hybrid Toy Objects

##

# Toy generating objects


## ToyMCSamplerOpt

This is a derived class of the RooStats [ToyMCSampler](https://root.cern.ch/doc/master/classRooStats_1_1ToyMCSampler.html)
The ToyMCSampler is used to both generate toys for a given point in parameter space of the model, and evaluate some test statistic on those toys.

KYLE NOTE: It's not clear to me yet what the exact differences are and what the need for a separate derived class is.

## SimPdfGenInfo

A sort of container class which holds various info about simultaneous pdf, observables, data, categories, arg set.
This can be used to generate toys. 

## SinglePdfGenInfo

A class which holds holds various info about a pdf and can efficiengtly generate events or asimov data for that pdf. Not simultaneous pdf, but single pdf.



